
import unittest
import ROOT

from spectrum.spectrum import PtAnalyzer
from spectrum.input import Input

class TestSpectrum(unittest.TestCase):

	def testPi0SpectrumLHC16l(self):
		# These are values calculated by standard algorithm.
		# Make sure that you have the same copy of LHC16l.root file. 
		# sha 256 sum: db8e0f8517f3f094b9c039f3cb263211c8c781bd1395a404ff961355e4c6dc7c
		# This is to test the code after refactoring.

		# TODO: update/remove this test?
		nominal = [[0.13848088681697845, 0.1383083015680313, 0.13832122087478638, 0.13822796940803528, 0.13823282718658447, 0.138167604804039, 0.13811887800693512, 0.13807222247123718, 0.1378369927406311, 0.13763011991977692, 0.1380324363708496, 0.13842663168907166, 0.13825346529483795, 0.1382879912853241, 0.13809631764888763, 0.1377929449081421, 0.13762228190898895, 0.1379738599061966, 0.13750530779361725, 0.13735724985599518, 0.13720162212848663, 0.13728106021881104, 0.1377563178539276, 0.1373967081308365, 0.13707216084003448, 0.13905221223831177, 0.14127646386623383, 0.14191934466362, 0.1380760371685028, 0.12026670575141907, 0.13865232467651367, 0.14557026326656342], [0.00611430499702692, 0.005920907016843557, 0.005885075777769089, 0.005476741120219231, 0.005449047312140465, 0.005166972056031227, 0.004659944213926792, 0.004337269347161055, 0.004537138156592846, 0.004511635284870863, 0.004362725652754307, 0.004426056519150734, 0.00440404936671257, 0.004127911292016506, 0.004000000189989805, 0.004000000189989805, 0.004380316007882357, 0.004000000189989805, 0.004110755864530802, 0.004398512654006481, 0.004743511788547039, 0.0054037547670304775, 0.004000000189989805, 0.004339608829468489, 0.005454470403492451, 0.004000000189989805, 0.004000000189989805, 0.004000000189989805, 0.0059379893355071545, 0.029514452442526817, 0.004000000189989805, 0.0160903949290514], [4.394284725189209, 3.716546058654785, 4.569248676300049, 5.202285289764404, 5.134965419769287, 4.628657341003418, 3.8905696868896484, 3.264158010482788, 2.754100799560547, 2.3231709003448486, 1.9987983703613281, 1.7277628183364868, 1.4002983570098877, 1.1301453113555908, 1.0090115070343018, 0.7682626247406006, 0.36083269119262695, 0.3099999725818634, 0.32731255888938904, 0.30638378858566284, 0.17437754571437836, 0.17585209012031555, 0.12969857454299927, 0.12466778606176376, 0.510407030582428, 0.15270492434501648, 0.1123756393790245, 0.11529024690389633, 0.16413514316082, 5.496445655822754, 0.014625601470470428, -0.03571691736578941], [149.34432983398438, 1.753708004951477, 1.7477904558181763, 1.503010869026184, 1.55549955368042, 1.4570811986923218, 1.6971232891082764, 1.6134387254714966, 1.4837110042572021, 1.6301970481872559, 1.5572965145111084, 1.6221122741699219, 2.305565118789673, 1.91972815990448, 2.852348566055298, 2.0071492195129395, 1.6129083633422852, 1.8426276445388794, 1.0740305185317993, 0.8503637909889221, 0.8460671901702881, 1.0788966417312622, 0.9657233953475952, 1.9507358074188232, 3.1751925945281982, 7.902723789215088, 77.71343994140625, 0.3687083423137665, 6.903605937957764, 27320.416015625, 0.2621774971485138, 6.378359317779541], [4.819395542144775, 4.430713176727295, 7.192117214202881, 8.7044095993042, 10.496070861816406, 9.895569801330566, 8.134808540344238, 8.003949165344238, 9.358287811279297, 7.460703372955322, 8.344232559204102, 8.229191780090332, 6.4118828773498535, 6.745240211486816, 5.562263011932373, 5.04893684387207, 6.113062858581543, 5.273258686065674, 6.314956188201904, 5.322268486022949, 3.806645393371582, 3.9224541187286377, 2.506462335586548, 2.26739239692688, 1.3861743211746216, 1.5387413501739502, 1.561975359916687, 1.8763245344161987, 1.1913440227508545, 1.0198736190795898, 1.8055214881896973, 0.6418870687484741]]

		second = PtAnalyzer(Input('input-data/LHC16l.root', 'PhysTender').read(), label = 'Mixing', mode = 'q').quantities()
		actual = [ [ h.GetBinContent(i) for i in range(1, h.GetNbinsX())] for h in second]

		for a, b, c in zip(nominal, actual, second):
				print 'Checking ', c.GetName()
				for aa, bb in zip(a, b): self.assertAlmostEqual(aa, bb)