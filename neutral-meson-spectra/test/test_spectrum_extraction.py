
import unittest
import ROOT

from spectrum.spectrum import PtAnalyzer
from spectrum.input import Input

class TestSpectrum(unittest.TestCase):

	def testPi0SpectrumLHC16l(self):
		# These are values calculated by standard algorithm.
		# Make sure that you have the same copy of LHC16.root file. 
		# sha 256 sum: db8e0f8517f3f094b9c039f3cb263211c8c781bd1395a404ff961355e4c6dc7c
		# This is to test the code after refactoring.

		# TODO: update/remove this test?
		nominal = [[0.13848088681697845, 0.13828511536121368, 0.13823994994163513, 0.13816820085048676, 0.1382240504026413, 0.13814900815486908, 0.1380801498889923, 0.1380479484796524, 0.13782799243927002, 0.13760854303836823, 0.13801124691963196, 0.1384013593196869, 0.13820196688175201, 0.13826081156730652, 0.13810060918331146, 0.13780196011066437, 0.13759833574295044, 0.13796329498291016, 0.13750530779361725, 0.13735724985599518, 0.13720162212848663, 0.13728106021881104, 0.1377563178539276, 0.1373967081308365, 0.13707216084003448, 0.13905221223831177, 0.14127646386623383, 0.14191934466362, 0.1380760371685028, 0.12026670575141907, 0.13865232467651367, 0.14557026326656342], [0.00611430499702692, 0.0060094427317380905, 0.005940951406955719, 0.005489265080541372, 0.005374411586672068, 0.00516161136329174, 0.004745774902403355, 0.004377311561256647, 0.0045454055070877075, 0.004509542137384415, 0.004366124048829079, 0.004323411732912064, 0.004332812502980232, 0.004140882752835751, 0.004000000189989805, 0.004000000189989805, 0.0044335476122796535, 0.004000000189989805, 0.004110755864530802, 0.004398512654006481, 0.004743511788547039, 0.0054037547670304775, 0.004000000189989805, 0.004339608829468489, 0.005454470403492451, 0.004000000189989805, 0.004000000189989805, 0.004000000189989805, 0.0059379893355071545, 0.029514452442526817, 0.004000000189989805, 0.0160903949290514], [4.394284725189209, 3.8298611640930176, 4.361423015594482, 4.893136501312256, 5.013472557067871, 4.542922019958496, 3.8443098068237305, 3.19132661819458, 2.7169525623321533, 2.221317768096924, 1.9409315586090088, 1.643011450767517, 1.3173328638076782, 1.0886865854263306, 1.0043036937713623, 0.750325620174408, 0.3564240634441376, 0.3028069734573364, 0.32731255888938904, 0.30638378858566284, 0.17437754571437836, 0.17585209012031555, 0.12969857454299927, 0.12466778606176376, 0.510407030582428, 0.15270492434501648, 0.1123756393790245, 0.11529024690389633, 0.16413514316082, 5.496445655822754, 0.014625601470470428, -0.03571691736578941], [149.34432983398438, 1.795995831489563, 1.9149119853973389, 1.529389500617981, 1.5132492780685425, 1.3767731189727783, 1.6967785358428955, 1.7453685998916626, 1.6737383604049683, 1.7003772258758545, 1.7994470596313477, 1.7482818365097046, 2.335381031036377, 1.8158568143844604, 2.976055383682251, 1.9956586360931396, 1.6945616006851196, 1.7280707359313965, 1.0740305185317993, 0.8503637909889221, 0.8460671901702881, 1.0788966417312622, 0.9657233953475952, 1.9507358074188232, 3.1751925945281982, 7.902723789215088, 77.71343994140625, 0.3687083423137665, 6.903605937957764, 27320.416015625, 0.2621774971485138, 6.378359317779541], [4.819395542144775, 4.228025913238525, 11.726775169372559, 19.222726821899414, 12.23419189453125, 12.047880172729492, 10.329257011413574, 10.26630973815918, 10.826713562011719, 10.861712455749512, 11.052289962768555, 11.743868827819824, 9.550834655761719, 9.094244956970215, 5.439443588256836, 5.200047492980957, 6.941402435302734, 5.855371475219727, 6.314956188201904, 5.322268486022949, 3.806645393371582, 3.9224541187286377, 2.506462335586548, 2.26739239692688, 1.3861743211746216, 1.5387413501739502, 1.561975359916687, 1.8763245344161987, 1.1913440227508545, 1.0198736190795898, 1.8055214881896973, 0.6418870687484741]]


		second = PtAnalyzer(Input('input-data/LHC16.root', 'PhysTender').read(), label = 'Mixing', mode = 'q').quantities()
		actual = [ [ h.GetBinContent(i) for i in range(1, h.GetNbinsX())] for h in second]

		for a, b, c in zip(nominal, actual, second):
				print 'Checking ', c.GetName()
				for aa, bb in zip(a, b): self.assertAlmostEqual(aa, bb)