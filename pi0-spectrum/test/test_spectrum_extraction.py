
import unittest
import ROOT

from spectrum.spectrum import PtAnalyzer
from spectrum.input import Input

class TestSpectrum(unittest.TestCase):

	def testPi0SpectrumLHC16l(self):
		# These are values calculated by standard algorithm.
		# Make sure that you have the same copy of LHC16l.root file. 
		# sha sum: 535b8fd27f6c54dd74687a93c5cf192c142c1384
		# This is to test the code after refactoring.

		# TODO: update/remove this test?
		nominal = [[0.13855727016925812, 0.13828511536121368, 0.13823994994163513, 0.13816820085048676, 0.1382240504026413, 0.13814900815486908, 0.1380801498889923, 0.1380479484796524, 0.13782799243927002, 0.13760854303836823, 0.13801124691963196, 0.1384013593196869, 0.13820196688175201, 0.13826081156730652, 0.13810060918331146, 0.13780196011066437, 0.13759833574295044, 0.13796329498291016, 0.13757026195526123, 0.13742394745349884, 0.13713008165359497, 0.13726980984210968, 0.13780374825000763, 0.1375194489955902, 0.1371024250984192, 0.13908778131008148, 0.14130465686321259, 0.14189891517162323, 0.15000000596046448, 0.12248189002275467, 0.1388234794139862, 0.14557026326656342], [0.006065519526600838, 0.0060094427317380905, 0.005940951406955719, 0.005489265080541372, 0.005374411586672068, 0.00516161136329174, 0.004745774902403355, 0.004377311561256647, 0.0045454055070877075, 0.004509542137384415, 0.004366124048829079, 0.004323411732912064, 0.004332812502980232, 0.004140882752835751, 0.004000000189989805, 0.004000000189989805, 0.0044335476122796535, 0.004000000189989805, 0.00400000112131238, 0.004317182116210461, 0.004826789256185293, 0.005330700892955065, 0.0040000006556510925, 0.004219222813844681, 0.00560323242098093, 0.004000000189989805, 0.004000000189989805, 0.004000000189989805, 0.029999999329447746, 0.029015259817242622, 0.004000000189989805, 0.0160903949290514], [0.9374039173126221, 0.7659721970558167, 0.8722845911979675, 0.9786273241043091, 1.0026944875717163, 0.9085844159126282, 0.7688619494438171, 0.6382653117179871, 0.5433905124664307, 0.4442635476589203, 0.3881863057613373, 0.32860231399536133, 0.26346656680107117, 0.2177373170852661, 0.20086073875427246, 0.1500651240348816, 0.0891060158610344, 0.050467830151319504, 0.07767923176288605, 0.052298061549663544, 0.04272831976413727, 0.02826538495719433, 0.036965493112802505, 0.02284969761967659, 0.15350250899791718, 0.03371034562587738, 0.03148312494158745, 0.01830885373055935, 0.10578314960002899, 2.2935304641723633, 0.0020975444931536913, -0.007143380586057901], [1.6812150478363037, 1.795995831489563, 1.9149119853973389, 1.529389500617981, 1.5132492780685425, 1.3767731189727783, 1.6967785358428955, 1.7453685998916626, 1.6737383604049683, 1.7003772258758545, 1.7994470596313477, 1.7482818365097046, 2.335381031036377, 1.8158568143844604, 2.976055383682251, 1.9956586360931396, 1.6945616006851196, 1.7280707359313965, 0.9806122779846191, 0.8938915729522705, 0.9904825091362, 1.3496043682098389, 0.8079001903533936, 2.962392807006836, 0.7913458347320557, 17.147541046142578, 111.8158187866211, 0.1555853933095932, 4.312243461608887, 21493.927734375, 0.30331951379776, 6.0661797523498535], [3.8621020317077637, 4.228025913238525, 11.726775169372559, 19.222726821899414, 12.23419189453125, 12.047880172729492, 10.329257011413574, 10.26630973815918, 10.826713562011719, 10.861712455749512, 11.052289962768555, 11.743868827819824, 9.550834655761719, 9.094244956970215, 5.439443588256836, 5.200047492980957, 6.941402435302734, 5.855371475219727, 6.607926368713379, 4.496577262878418, 4.290707588195801, 4.2806077003479, 2.103076219558716, 1.9856982231140137, 1.3177571296691895, 1.3838926553726196, 1.4775466918945312, 1.9977240562438965, 2.0784621238708496, 1.1261467933654785, 2.3193373680114746, 0.6418869495391846]] 


		second = PtAnalyzer(Input('input-data/LHC16l.root', 'PhysTender').read(), label = 'Mixing', mode = 'q').quantities()
		actual = [ [ h.GetBinContent(i) for i in range(1, h.GetNbinsX())] for h in second]

		for a, b, c in zip(nominal, actual, second):
				print 'Checking ', c.GetName()
				for aa, bb in zip(a, b): self.assertAlmostEqual(aa, bb)